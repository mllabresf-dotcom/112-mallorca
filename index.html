
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>112 Mallorca</title>
<link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSEA69X_qWWBU-3O3PcgrumqVEJoVA4dXWhIw&s" />
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;
const Phone=()=><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>;
const MapPin=()=><svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>;
const User=()=><svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
const Send=()=><svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>;
const LogIn=()=><svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>;
const Shield=()=><svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
const Clock=()=><svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
const Activity=()=><svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>;

function Emergency112(){
const [formData,setFormData]=useState({servicio:'',incidente:'',ciudadano:'',ubicacion:'',nivel:10});
const [isSubmitting,setIsSubmitting]=useState(false);
const [notification,setNotification]=useState({show:false,message:'',type:''});
const [discordUser,setDiscordUser]=useState(null);
const [isLoadingUser,setIsLoadingUser]=useState(true);
const [currentTime,setCurrentTime]=useState(new Date());

const servicios = [
  {
    value: 'PolicÃ­a Local',
    icon: 'ğŸ‘®â€â™€ï¸',
    emoji: 'ğŸš“',
    roleId: 'ROLE_ID_POLICIA_LOCAL'
  },
  {
    value: 'PolicÃ­a Nacional',
    icon: 'ğŸ‘®â€â™‚ï¸',
    emoji: 'ğŸš”',
    roleId: '1398228126919561216'
  },
  {
    value: 'Guardia Civil',
    icon: 'ğŸ›¡ï¸',
    emoji: 'ğŸš¨',
    roleId: 'ROLE_ID_GUARDIA_CIVIL'
  },
  {
    value: 'SAMU 061',
    icon: 'ğŸš‘',
    emoji: 'ğŸ¥',
    roleId: '1398274968705568878'
  },
  {
    value: 'Bomberos',
    icon: 'ğŸš’',
    emoji: 'ğŸ”¥',
    roleId: '1398274299151913061'
  },
  {
    value: 'ConservaciÃ³n',
    icon: 'ğŸ§°',
    emoji: 'âš™ï¸',
    roleId: 'ROLE_ID_CONSERVACION'
  }
];


const getPrioridad=(n)=>{
if(n>=1&&n<=5)return{label:'BAJA',icon:'ğŸŸ¢',colorHex:1096065,bg:'from-green-500 to-green-700',text:'text-green-400'};
if(n>=6&&n<=10)return{label:'MEDIA',icon:'ğŸŸ¡',colorHex:16162315,bg:'from-yellow-500 to-yellow-700',text:'text-yellow-400'};
return{label:'ALTA',icon:'ğŸ”´',colorHex:15680580,bg:'from-red-500 to-red-700',text:'text-red-400'};
};

useEffect(()=>{
const timer=setInterval(()=>setCurrentTime(new Date()),1000);
return()=>clearInterval(timer);
},[]);

useEffect(()=>{
const token=localStorage.getItem('discord_token');
if(token){
fetchDiscordUser(token);
}else{
const fragment=new URLSearchParams(window.location.hash.slice(1));
const accessToken=fragment.get('access_token');
if(accessToken){
localStorage.setItem('discord_token',accessToken);
fetchDiscordUser(accessToken);
window.history.replaceState({},document.title,window.location.pathname);
}else{
setIsLoadingUser(false);
}
}
},[]);

const fetchDiscordUser=async(token)=>{
try{
const response=await fetch('https://discord.com/api/users/@me',{
headers:{Authorization:`Bearer ${token}`}
});
if(response.ok){
setDiscordUser(await response.json());
}else{
localStorage.removeItem('discord_token');
}
}catch(error){
localStorage.removeItem('discord_token');
}finally{
setIsLoadingUser(false);
}
};

const handleDiscordLogin=()=>{
window.location.href='https://discord.com/api/oauth2/authorize?client_id=1457002138868777163&response_type=token&redirect_uri=https%3A%2F%2Fandoficial.github.io%2F112-valencia%2F&scope=identify';
};

const handleLogout=()=>{
localStorage.removeItem('discord_token');
setDiscordUser(null);
};

const handleSubmit=async()=>{
if(!discordUser){showNotification('Debe iniciar sesiÃ³n','error');return;}
if(!formData.servicio||!formData.incidente||!formData.ciudadano||!formData.ubicacion){showNotification('Complete todos los campos','error');return;}

setIsSubmitting(true);
try{
const servicio=servicios.find(s=>s.value===formData.servicio);
const prioridad=getPrioridad(formData.nivel);
const timestamp=new Date();

const embed={
author:{name:"ğŸš¨ SISTEMA 112 MALLORCA",icon_url:"https://cdn-icons-png.flaticon.com/512/3588/3588592.png"},
title:`${prioridad.icon} EMERGENCIA - PRIORIDAD ${prioridad.label}`,
description:`â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘ **${servicio.emoji} ${servicio.value.toUpperCase()}** â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## ğŸ“‹ DESCRIPCIÃ“N\n\`\`\`\n${formData.incidente}\n\`\`\`\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`,
color:prioridad.colorHex,
fields:[
{name:`${prioridad.icon} PRIORIDAD`,value:`\`\`\`${prioridad.label} (Nivel ${formData.nivel}/20)\`\`\``,inline:true},
{name:"âš¡ ESTADO",value:"`\`\`ACTIVA\`\`\`",inline:true},
{name:"\u200b",value:"â”â”â”â”â”â” DATOS DEL AFECTADO â”â”â”â”â”â”",inline:false},
{name:"ğŸ‘¤ CIUDADANO (IC)",value:`\`\`\`${formData.ciudadano}\`\`\``,inline:false},
{name:"ğŸ“ UBICACIÃ“N",value:`\`\`\`${formData.ubicacion}\`\`\``,inline:false},
{name:"\u200b",value:"â”â”â”â”â”â” OPERADOR â”â”â”â”â”â”",inline:false},
{name:"ğŸ‘¨â€ğŸ’¼ RESPONSABLE",value:`<@${discordUser.id}> â€¢ \`${discordUser.username}\``,inline:true},
{name:"ğŸ”’ VERIFICACIÃ“N",value:"`âœ“ CONFIRMADA`",inline:true},
{name:"\u200b",value:"\u200b",inline:false},
{name:"ğŸ“… FECHA",value:`\`${timestamp.toLocaleDateString('es-ES',{day:'2-digit',month:'long',year:'numeric'})}\``,inline:true},
{name:"â° HORA",value:`\`${timestamp.toLocaleTimeString('es-ES')}\``,inline:true},
{name:"\u200b",value:"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",inline:false},
{name:"ğŸ“Š REPORTE",value:`**ID:** \`EMG-${timestamp.getTime()}\`\n**Sistema:** 112 Valencia v2.0`,inline:false}
],
thumbnail:{url:`https://cdn.discordapp.com/avatars/${discordUser.id}/${discordUser.avatar}.png`},
footer:{text:"112 Mallorca â€¢ Sistema de Emergencias Â©",icon_url:"https://cdn-icons-png.flaticon.com/512/3588/3588592.png"},
timestamp:timestamp.toISOString()
};

const roleMention=`<@&${servicio.roleId}>`;

const response=await fetch('https://discord.com/api/webhooks/1460196161552912396/UoovYIV54-9MdmuYbGiuvwPwOQRRVQEn2iKnQWC3HddozJT6CVHCkshqCNXJz6j3ZrtN',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
content:`${roleMention}\n\nâš ï¸ **NUEVA EMERGENCIA** âš ï¸\n\n${prioridad.icon} **${prioridad.label}** (Nivel ${formData.nivel}/20)\n${servicio.emoji} **${servicio.value}**\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`,
username:'Central 112 Valencia',
avatar_url:'https://cdn-icons-png.flaticon.com/512/3588/3588592.png',
embeds:[embed]
})
});

if(!response.ok){
throw new Error('Error al enviar');
}

showNotification('âœ“ Emergencia reportada','success');
setFormData({servicio:'',incidente:'',ciudadano:'',ubicacion:'',nivel:10});
}catch(error){
showNotification('Error de conexiÃ³n','error');
}finally{
setIsSubmitting(false);
}
};

const showNotification=(message,type)=>{
setNotification({show:true,message,type});
setTimeout(()=>setNotification({show:false,message:'',type:''}),4000);
};

const prioridadActual=getPrioridad(formData.nivel);

if(isLoadingUser){
return(
<div className="min-h-screen bg-gradient-to-br from-slate-900 via-red-900 to-slate-900 flex items-center justify-center">
<div className="text-center">
<div className="w-20 h-20 border-4 border-red-500/30 border-t-red-500 rounded-full animate-spin mx-auto mb-4"></div>
<p className="text-white font-bold text-lg">Cargando sistema...</p>
</div>
</div>
);
}

return(
<div className="min-h-screen bg-gradient-to-br from-slate-900 via-red-900 to-slate-900">
<header className="bg-black/50 backdrop-blur-xl border-b border-white/10 sticky top-0 z-50">
<div className="max-w-7xl mx-auto px-4 py-4">
<div className="flex items-center justify-between">
<div className="flex items-center gap-4">
<div className="w-14 h-14 bg-gradient-to-br from-red-600 to-orange-600 rounded-2xl flex items-center justify-center shadow-2xl">
<Phone/>
</div>
<div>
<h1 className="text-2xl font-black text-white">112 Mallorca</h1>
<p className="text-xs text-slate-300 font-semibold">Sistema de Emergencias</p>
</div>
</div>
<div className="flex items-center gap-4">
<div className="flex items-center gap-2 bg-white px-3 py-2 rounded-xl">
<Clock/>
<span className="text-sm font-bold text-black">{currentTime.toLocaleTimeString('es-ES')}</span>
</div>
{discordUser&&(
<div className="flex items-center gap-3 bg-green-500/20 px-4 py-2 rounded-xl border border-green-500/30">
<img src={`https://cdn.discordapp.com/avatars/${discordUser.id}/${discordUser.avatar}.png`} className="w-9 h-9 rounded-full ring-2 ring-green-400"/>
<div className="hidden sm:block">
<p className="text-sm font-bold text-white">{discordUser.username}</p>
<p className="text-xs text-green-300">â— Activo</p>
</div>
<button onClick={handleLogout} className="text-xs text-slate-300 hover:text-red-400 font-bold">Salir</button>
</div>
)}
</div>
</div>
</div>
</header>

<main className="max-w-7xl mx-auto px-4 py-8">
{!discordUser?(
<div className="max-w-lg mx-auto mt-20">
<div className="bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 p-12 text-center">
<div className="w-28 h-28 bg-gradient-to-br from-blue-600 to-purple-600 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-2xl">
<Shield/>
</div>
<h2 className="text-4xl font-black text-white mb-4">Acceso Seguro</h2>
<p className="text-slate-300 text-lg mb-8">AutenticaciÃ³n requerida</p>
<button onClick={handleDiscordLogin} className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-5 rounded-2xl flex items-center justify-center gap-3 shadow-2xl transform hover:scale-105 transition-all">
<LogIn/>
<span className="text-lg">Iniciar SesiÃ³n con Discord</span>
</button>
</div>
</div>
):(
<div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
<div className="lg:col-span-2 space-y-6">
<div className="bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/20 p-6">
<h3 className="text-xl font-black text-white mb-5">Servicio de Emergencia</h3>
<div className="grid grid-cols-3 gap-4">
{servicios.map(s=>(
<button key={s.value} onClick={()=>setFormData({...formData,servicio:s.value})} className={`p-6 rounded-xl border-2 transition-all ${formData.servicio===s.value?'border-blue-500 bg-blue-500/20 scale-105 shadow-xl':'border-white/10 bg-white/5 hover:bg-white/10'}`}>
<div className="text-5xl mb-2">{s.icon}</div>
<p className="font-bold text-white text-sm">{s.value}</p>
</button>
))}
</div>
</div>

<div className="bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/20 p-6">
<h3 className="text-xl font-black text-white mb-5">Nivel de Prioridad</h3>
<div className="space-y-4">
<div className="flex items-center gap-3">
<span className="text-4xl">{prioridadActual.icon}</span>
<div>
<p className={`text-2xl font-black ${prioridadActual.text}`}>{prioridadActual.label}</p>
<p className="text-sm text-slate-400">Nivel {formData.nivel}/20</p>
</div>
</div>
<input type="range" min="1" max="20" value={formData.nivel} onChange={(e)=>setFormData({...formData,nivel:parseInt(e.target.value)})} className="w-full h-3 rounded-lg appearance-none cursor-pointer" style={{background:'linear-gradient(to right,#10b981 0%,#10b981 25%,#f59e0b 25%,#f59e0b 50%,#ef4444 50%,#ef4444 100%)'}}/>
<div className="flex justify-between text-xs text-slate-400 font-bold">
<span>1-5 Baja ğŸŸ¢</span>
<span>6-10 Media ğŸŸ¡</span>
<span>11-20 Alta ğŸ”´</span>
</div>
</div>
</div>

<div className="bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/20 p-6">
<h3 className="text-xl font-black text-white mb-5">InformaciÃ³n del Incidente</h3>
<div className="space-y-4">
<div>
<label className="block text-sm font-bold text-slate-300 mb-2">DescripciÃ³n *</label>
<textarea value={formData.incidente} onChange={(e)=>setFormData({...formData,incidente:e.target.value})} placeholder="Describa la emergencia..." rows="3" className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:ring-2 focus:ring-blue-500 outline-none"/>
</div>
<div>
<label className="block text-sm font-bold text-slate-300 mb-2 flex items-center gap-2"><User/>Ciudadano (IC) *</label>
<input type="text" value={formData.ciudadano} onChange={(e)=>setFormData({...formData,ciudadano:e.target.value})} placeholder="Nombre del ciudadano" className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:ring-2 focus:ring-blue-500 outline-none"/>
</div>
<div>
<label className="block text-sm font-bold text-slate-300 mb-2 flex items-center gap-2"><MapPin/>UbicaciÃ³n *</label>
<input type="text" value={formData.ubicacion} onChange={(e)=>setFormData({...formData,ubicacion:e.target.value})} placeholder="UbicaciÃ³n exacta" className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:ring-2 focus:ring-blue-500 outline-none"/>
</div>
</div>
</div>
</div>

<div className="space-y-6">
<div className="bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/20 p-6">
<h3 className="text-sm font-bold text-slate-300 mb-4 uppercase">Operador</h3>
<div className="flex items-center gap-3">
<img src={`https://cdn.discordapp.com/avatars/${discordUser.id}/${discordUser.avatar}.png`} className="w-16 h-16 rounded-xl ring-2 ring-white/20"/>
<div>
<p className="font-bold text-white text-lg">{discordUser.username}</p>
<p className="text-xs text-green-400">âœ“ Verificado</p>
</div>
</div>
</div>

<div className="bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/20 p-6">
<h3 className="text-sm font-bold text-slate-300 mb-4 uppercase">Estado</h3>
<div className="space-y-2 text-sm">
<div className="flex justify-between">
<span className="text-slate-400">ConexiÃ³n</span>
<span className="text-green-400 font-bold">â— Activa</span>
</div>
<div className="flex justify-between">
<span className="text-slate-400">Webhook</span>
<span className="text-green-400 font-bold">â— Operativo</span>
</div>
</div>
</div>

<button onClick={handleSubmit} disabled={isSubmitting} className="w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 disabled:from-slate-600 disabled:to-slate-700 text-white font-black py-5 rounded-xl flex items-center justify-center gap-3 shadow-2xl transform hover:scale-105 transition-all">
{isSubmitting?<div className="w-6 h-6 border-3 border-white border-t-transparent rounded-full animate-spin"></div>:<><Send/><span className="text-lg">REPORTAR EMERGENCIA</span></>}
</button>
</div>
</div>
)}
</main>

{notification.show&&(
<div className="fixed top-6 right-6 z-50">
<div className={`${notification.type==='success'?'bg-green-600':'bg-red-600'} text-white px-6 py-4 rounded-xl shadow-2xl font-bold`}>
{notification.message}
</div>
</div>
)}
</div>
);
}

ReactDOM.render(React.createElement(Emergency112),document.getElementById('root'));
</script>
</body>
</html>
